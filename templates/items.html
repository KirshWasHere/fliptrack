{% extends "base.html" %}

{% block title %}Items - FlipTrack{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Search and Filter -->
    <div class="bg-dark-surface border border-dark-border rounded-lg p-4">
        <form method="GET" class="flex gap-4">
            <input type="text" name="search" value="{{ search }}" placeholder="Search items..." 
                   class="flex-1 bg-dark-bg border border-dark-border rounded-md px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
            <select name="status" class="bg-dark-bg border border-dark-border rounded-md px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="All" {% if status == 'All' %}selected{% endif %}>All Status</option>
                <option value="Draft" {% if status == 'Draft' %}selected{% endif %}>Draft</option>
                <option value="Listed" {% if status == 'Listed' %}selected{% endif %}>Listed</option>
                <option value="Sold" {% if status == 'Sold' %}selected{% endif %}>Sold</option>
            </select>
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-md">Search</button>
        </form>
    </div>

    <!-- Items Table -->
    <div class="bg-dark-surface border border-dark-border rounded-lg">
        <div class="px-6 py-4 border-b border-dark-border">
            <h2 class="text-xl font-bold text-white">All Items ({{ items|length }})</h2>
        </div>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-dark-border">
                <thead class="bg-dark-bg">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase">ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase">Item</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase">Purchase</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase">Target</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase">Profit</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-dark-muted uppercase">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-dark-border">
                    {% for item in items %}
                    {% set total_expenses = item.purchase_price + item.shipping_cost + item.get('listing_fee', 0) + item.get('processing_fee', 0) + item.get('storage_cost', 0) + item.get('other_expenses', 0) %}
                    {% set profit = item.target_price - total_expenses %}
                    <tr class="hover:bg-dark-bg">
                        <td class="px-6 py-4 text-sm text-dark-muted">{{ item.id }}</td>
                        <td class="px-6 py-4">
                            <div class="text-sm font-medium text-white">{{ item.item_name[:50] }}</div>
                            <div class="text-xs text-dark-muted">{{ item.category }}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 text-xs font-semibold rounded-full 
                                {% if item.status == 'Sold' %}bg-green-900 text-green-300
                                {% elif item.status == 'Listed' %}bg-blue-900 text-blue-300
                                {% else %}bg-yellow-900 text-yellow-300{% endif %}">
                                {{ item.status }}
                            </span>
                        </td>
                        <td class="px-6 py-4 text-sm text-dark-text">${{ "%.2f"|format(item.purchase_price) }}</td>
                        <td class="px-6 py-4 text-sm text-dark-text">${{ "%.2f"|format(item.target_price) }}</td>
                        <td class="px-6 py-4 text-sm font-semibold {% if profit >= 0 %}text-green-400{% else %}text-red-400{% endif %}">
                            ${{ "%.2f"|format(profit) }}
                        </td>
                        <td class="px-6 py-4 text-sm space-x-2">
                            <a href="/item/{{ item.id }}" class="text-blue-400 hover:text-blue-300">View</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}
